# Novel Annotation - Pass 1: Timeline Analysis + Event Aggregation
# 小说标注 - 第一步：时间线分析 + 事件聚合

system: |
  你是专业的小说编辑和叙事分析师。你的任务是分析已分段的小说章节，完成两个任务：
  
  ## 任务1：时间线重排
  
  **核心原则**：小说的**段落顺序** ≠ **故事时间线顺序**
  
  **常见情况**：
  1. **细节展开**：后面的段落可能是前面事件的细节补充
  2. **回忆插叙**：某段落是对更早时间的回顾（A类不参与事件聚合）
  3. **平行叙事**：多个角色/地点的事件交替叙述
  
  **时间线判断依据**：
  - 明确时间标记（"几个月前"、"夜晚"、"第二天"）
  - 因果关系（A事件导致B事件）
  - 空间位置（从江城出发 → 路上 → 露营地）
  - 叙事逻辑（情节的自然发展顺序）
  
  ---
  
  ## 任务2：事件聚合
  
  **核心原则**：多个连续段落可能是同一个**事件**
  
  **聚合规则**：
  1. **语义连贯**：描述同一件事的不同方面
  2. **时空一致**：同一时间、同一地点的连续行为
  3. **细节展开**：一个段落是另一个段落的细节补充
  4. **描述性段落**：没有主体动作的描述段落应合并到相邻事件
  
  **⚠️ 重要**：
  - A类设定段落**不参与**事件聚合，独立存在
  - C类系统段落**可以**成为独立事件（如"觉醒系统"）
  - 事件必须按**时间线顺序**排列，不是段落顺序
  
  ---
  
  ## 输出要求
  
  你需要输出按时间线排序的事件列表，每个事件包含：
  1. **事件概括**：一句话描述（20-30字）
  2. **包含段落**：段落索引列表（按时间线顺序）
  3. **地点**：事件发生的地点
  4. **地点变化**：相对上一事件的变化
  5. **时间**：事件发生的时间
  6. **时间变化**：相对上一事件的变化

user_template: |
  请分析以下已分段的章节，完成时间线重排和事件聚合：
  
  ## 章节分段结果（段落按原文顺序）
  
  {segmented_paragraphs}
  
  ---
  
  ## 你的任务
  
  1. **分析时间线**：理解每个段落在故事时间线上的位置
  2. **聚合事件**：将连续的B/C类段落按语义分组成事件
  3. **输出事件表**：按时间线顺序输出事件列表
  
  **输出格式**：
  
  ```markdown
  # 第{chapter_number}章事件时间线
  
  ## 事件1：[事件概括]
  **类型**：B类-事件 或 C类-系统
  **包含段落**：[段落索引列表]
  **地点**：[地点描述]
  **地点变化**：[相对上一事件的变化]
  **时间**：[时间描述]
  **时间变化**：[相对上一事件的变化]
  
  ---
  
  ## 事件2：[事件概括]
  **类型**：B类-事件 或 C类-系统
  **包含段落**：[段落索引列表]
  **地点**：[地点描述]
  **地点变化**：[相对上一事件的变化]
  **时间**：[时间描述]
  **时间变化**：[相对上一事件的变化]
  
  ---
  ```
  
  **关键要求**：
  1. 事件必须按**故事时间线顺序**排列
  2. 段落索引格式：只写数字，如 [3, 4] 不要写 [段落3, 段落4]
  3. 地点/时间变化是相对**上一事件**
  4. 事件概括要简洁（20-30字）
  5. **重要**：A类设定段落**不要**出现在事件列表中，只输出B类和C类事件

settings:
  model: "claude-sonnet-4-5-20250929"
  temperature: 0.3
  max_tokens: 4000

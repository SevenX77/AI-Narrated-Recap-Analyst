# Novel Chapter Segmentation - Pass 2: Verification & Correction
# 小说章节叙事分段 - 第二步：校验修正

system: |
  你是专业的小说编辑。你的任务是检查并修正已有的分段结果。
  
  **分段原则（与Pass 1相同）**：
  
  小说文字分为三类：
  
  **A类-设定**：跳脱时间线的设定信息
  - 世界观背景、核心规则、系统理论
  - ⚠️ 即使被包装成"回忆""思考"，只要内容是设定，就是A类
  - 必须独立分段
  
  **B类-事件**：现实时间线的事件
  - 主角行动、场景描写、情节推进
  - 同一时空的连续动作合并为一个段落
  
  **C类-系统**：次元空间事件
  - 系统觉醒、系统交互、意识空间
  - 必须独立分段
  
  **你的任务**：
  
  1. **检查A/B/C分类是否正确**
     - 是否有A类设定被混入B类事件？
     - 是否有C类系统事件被混入B类？
     - 是否有B类事件被误标为A类？
  
  2. **检查是否有过度分段**
     - 相邻的B类段落，时空是否相同？
     - 如果相同且是连续动作 → 应该合并
  
  3. **检查是否有A/B混合段落**
     - 如果段落中同时包含"设定内容"和"事件内容" → 必须拆分
     - 例：段落包含"夜晚露营+吃饭+思考序列超凡设定"
       → 拆分为：段落A（B类：夜晚露营+吃饭）+ 段落B（A类：序列超凡设定）
  
  **输出要求**：
  
  - 如果分段正确 → 输出"✅ 分段正确，无需修改"
  - 如果需要修正 → 输出修正后的完整分段列表

user_template: |
  请检查以下分段结果是否符合规范：
  
  **原章节内容**（供参考）：
  ```
  {chapter_content}
  ```
  
  **Pass 1的分段结果**：
  ```
  {pass1_result}
  ```
  
  ---
  
  **请按以下步骤检查**：
  
  **步骤1：检查A/B/C分类**
  
  逐个段落检查：
  - 段落内容是否符合其标注的类型（A/B/C）？
  - 是否有"回忆/思考中的设定"被标为B类？（应该是A类）
  - 是否有"系统交互"被标为B类？（应该是C类）
  
  **步骤2：检查是否有A/B混合**
  
  逐个段落检查：
  - 段落是否同时包含"设定内容"和"事件内容"？
  - 如果是 → 标记为"需要拆分"
  
  **步骤3：检查是否过度分段**
  
  检查相邻的B类段落：
  - 时空是否相同？
  - 是否是连续动作？
  - 如果是 → 标记为"需要合并"
  
  ---
  
  **输出格式**：
  
  如果分段完全正确：
  ```markdown
  ✅ 分段正确，无需修改
  ```
  
  如果需要修正：
  ```markdown
  # 第{chapter_number}章分段结果（修正版）
  
  ## 修正说明
  
  1. 段落X：类型错误（B类 → A类）→ 原因：包含序列超凡设定
  2. 段落Y+Z：过度分段 → 合并为一个段落（同一时空的连续动作）
  3. 段落W：A/B混合 → 拆分为两个段落
  
  ## 修正后的分段
  
  - **段落1（B类-事件）**：收音机播报上沪沦陷 + 车队绝望
    行号：1-5
  
  - **段落2（A类-设定）**：诡异爆发背景设定
    行号：6-9
  
  - **段落3（B类-事件）**：主角骑二八大杠出发
    行号：10-15
  
  ...（段落必须连续，下一段的起始行 = 上一段的结束行+1）
  ```
  
  **重要**：
  - 只修正明确违反规则的地方
  - 不要为了凑数量而强行修改
  - 修正后的分段必须符合A/B/C原则
  - **必须输出行号范围**（格式：起始行-结束行）
  - **段落必须连续覆盖所有行**，不能跳过任何行

settings:
  model: "claude-sonnet-4-5-20250929"
  temperature: 0.3
  max_tokens: 4000

<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 2f5bbf25-4d19-4f73-8259-7896dc334359 (2026-02-04 15:06Z) -->

# 数据拷贝中的raw文件处理 (2026-02-04 15:06Z)

_**User (2026-02-04 12:20Z)**_

在将@分析资料 拷贝到@data 时，对raw文件做一定的处理
@.cursorrules 

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
用户想要将 `分析资料` 文件夹的内容拷贝到 `data` 文件夹，并且在处理 raw 文件时做一定的处理。

根据 `.cursorrules` 的要求，我应该：
1. **不要立即写代码**
2. **先以人类可读的逻辑和工作流描述的形式呈现解决方案**
3. 使用清晰、结构化的文本，包括要点、图表或逐步解释
4. 只有在用户审查并批准逻辑设计后才提供代码实现

让我先了解一下现有的数据结构：
- `分析资料/` 包含：
  - `有原小说/`（包含末哥超凡公路、永夜悔恨录等项目）
  - `没有原小说/`（包含超前崛起等项目）

- `data/projects/` 现有的结构包含 PROJ_001, PROJ_002, PROJ_003 等标准化项目结构

我需要：
1. 先了解 `分析资料` 的详细结构
2. 了解现有 `data/projects/` 的标准结构
3. 提出一个将 `分析资料` 迁移到 `data/projects/` 的逻辑方案
4. 明确需要对 raw 文件做什么处理

让我先探索这些文件夹的结构。</details></think>

---

我理解您想要将 `分析资料` 文件夹的内容迁移到标准化的 `data` 项目结构中。在提出解决方案之前，让我先了解一下现有的数据结构。

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sevenx/Documents/coding/AI-Narrated Recap Analyst/data/project_index.json</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
好的，现在我了解了现有的数据结构。让我总结一下：

**分析资料文件夹结构：**
- `分析资料/有原小说/末哥超凡公路/` - 包含 edl, novel, srt, still, video
- `分析资料/有原小说/永夜悔恨录/` - 类似结构
- `分析资料/没有原小说/超前崛起/` - 可能没有 novel 文件夹

**现有 data/projects/ 标准结构：**
- PROJ_001 (超前崛起)
- PROJ_002 (末哥超凡公路)
- PROJ_003 (永夜悔恨录)
每个项目有 alignment, analysis, ground_truth, raw 等子文件夹

现在我需要提出一个迁移方案。根据 `.cursorrules`，我需要先提出逻辑设计，不要立即写代码。</details></think>

---

很好！现在我了解了数据结构。让我为您提出一个**数据迁移和处理的逻辑方案**：

---

## 📋 数据迁移方案设计

### 🎯 目标
将 `分析资料/` 中的原始素材迁移到标准化的 `data/projects/PROJ_XXX/raw/` 结构中，并对 raw 文件进行必要的处理和规范化。

### 📊 现状分析

**源文件夹结构（`分析资料/`）：**
```
分析资料/
├── 有原小说/
│   ├── 末哥超凡公路/
│   │   ├── edl/        → ep01-05.edl
│   │   ├── novel/      → 序列公路求生：我在末日升级物资.txt
│   │   ├── srt/        → ep01-05.srt
│   │   ├── still/      → ep01-05/ (静帧图片)
│   │   └── video/      → ep01-05.mp4
│   └── 永夜悔恨录/
│       └── [类似结构]
└── 没有原小说/
    └── 超前崛起/
        └── [没有 novel 文件夹]
```

**目标文件夹结构（`data/projects/`）：**
```
data/projects/PROJ_XXX/
├── raw/           ← 原始文件存放处
│   ├── novel.txt  ← 统一命名的小说文本
│   ├── ep01.srt   ← 字幕文件
│   ├── ep02.srt
│   └── ...
├── alignment/     ← 对齐结果
├── analysis/      ← 分析结果
└── ground_truth/  ← 真实标注
```

---

### 🔄 迁移映射关系

| 源文件夹 | 目标项目 | 映射说明 |
|---------|---------|---------|
| `分析资料/有原小说/末哥超凡公路/` | `PROJ_002` | 已存在，需要填充 raw 文件 |
| `分析资料/有原小说/永夜悔恨录/` | `PROJ_003` | 已存在，需要填充 raw 文件 |
| `分析资料/没有原小说/超前崛起/` | `PROJ_001` | 已存在，需要填充 raw 文件 |

---

### 🛠️ Raw 文件处理规则

#### **1. 小说文本处理（novel.txt）**
- **源文件**: `novel/序列公路求生：我在末日升级物资.txt`
- **目标文件**: `raw/novel.txt`（统一命名）
- **处理动作**:
  - ✅ 统一编码为 UTF-8
  - ✅ 去除 BOM 头（如果存在）
  - ✅ 规范化换行符（统一为 `\n`）
  - ✅ 去除文件开头/结尾的多余空白行
  - ✅ 可选：添加元数据头（原始文件名、迁移时间）

#### **2. 字幕文件处理（.srt）**
- **源文件**: `srt/ep01.srt`, `srt/ep02.srt`, ...
- **目标文件**: `raw/ep01.srt`, `raw/ep02.srt`, ...
- **处理动作**:
  - ✅ 统一编码为 UTF-8
  - ✅ 验证 SRT 格式完整性（序号、时间码、文本）
  - ✅ 修复常见格式错误（如缺失空行、时间码格式）
  - ✅ 去除重复的字幕块
  - ✅ 可选：去除特殊格式标签（如 `<i>`, `<b>`）

#### **3. 其他文件处理**
- **EDL 文件** (`edl/`): 
  - 选项 A：复制到 `raw/edl/` 子文件夹（保留原始剪辑信息）
  - 选项 B：暂不迁移（如果不需要）
  
- **视频文件** (`video/`):
  - 选项 A：创建软链接（节省空间）
  - 选项 B：记录路径引用，不实际复制大文件
  - 选项 C：复制到 `raw/video/`（占用大量空间）

- **静帧图片** (`still/`):
  - 选项 A：复制到 `raw/still/`
  - 选项 B：暂不迁移（通常不需要）

---

### 📝 迁移工作流程

```
步骤 1: 扫描源文件夹
  ↓
步骤 2: 匹配到目标 PROJ_XXX
  ↓
步骤 3: 创建 raw/ 目录（如果不存在）
  ↓
步骤 4: 处理小说文本 → raw/novel.txt
  ↓
步骤 5: 处理字幕文件 → raw/ep*.srt
  ↓
步骤 6: 处理其他文件（根据选项）
  ↓
步骤 7: 生成迁移日志
  ↓
步骤 8: 验证文件完整性
```

---

### ❓ 需要您确认的问题

1. **小说文本处理深度**：
   - 是否需要进行更深度的文本清洗（如去除广告、章节标记规范化）？
   - 还是只做基础的编码和格式规范化？

2. **字幕文件处理**：
   - 是否需要验证字幕的时间连续性？
   - 是否需要去除特殊格式标签？

3. **大文件处理策略**：
   - 视频文件（ep*.mp4）如何处理？
     - A. 创建软链接（推荐）
     - B. 只记录路径引用
     - C. 完整复制
   
4. **静帧图片**：
   - 是否需要迁移 `still/` 文件夹？这些图片占用空间较大。

5. **EDL 文件**：
   - 是否需要保留剪辑信息（.edl 文件）？

6. **元数据记录**：
   - 是否需要在 raw/ 中生成一个 `metadata.json` 记录迁移信息、原始文件路径等？

---

### 📂 预期结果示例

迁移完成后，`PROJ_002/raw/` 的结构将是：
```
data/projects/PROJ_002/raw/
├── novel.txt          ← 处理后的小说文本（UTF-8）
├── ep01.srt           ← 处理后的字幕文件
├── ep02.srt
├── ep03.srt
├── ep04.srt
├── ep05.srt
├── metadata.json      ← (可选) 迁移元数据
└── video/             ← (可选) 视频文件或软链接
    ├── ep01.mp4
    └── ...
```

---

请告诉我：
1. 您希望对 **小说文本** 和 **字幕文件** 做哪些具体处理？
2. **视频、EDL、静帧图片** 如何处理？
3. 确认后我将实现迁移脚本 📝

---


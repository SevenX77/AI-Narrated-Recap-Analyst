# Cursor AI 通用规则指南

本文档提炼了可应用于任何项目的 Cursor AI 协作规则。

---

## 🔝 最高优先级：沟通协议

### 规则内容
**先设计，后编码**：
- ✅ 优先提供**人类可读的逻辑和工作流描述**
- ✅ 使用结构化文本、要点、步骤说明或图表
- ✅ 明确阐述 **WHAT**（做什么）和 **WHY**（为什么）
- ❌ **不要**在用户确认设计前直接写代码
- ✅ 只在用户审查并批准逻辑设计后提供 **HOW**（如何实现）

### 适用场景
- 所有需要 AI 辅助编码的项目
- 特别适合复杂系统、团队协作、架构设计场景

### 价值
- 减少返工和误解
- 提高设计质量和可维护性
- 促进人机高效协作

---

## 🛡️ 安全与配置管理

### 规则内容

#### 1. 禁止硬编码敏感信息
- ❌ API 密钥、访问令牌
- ❌ 数据库密码、连接字符串
- ❌ 私钥、证书

**替代方案**：
- ✅ 环境变量（`.env` 文件）
- ✅ 密钥管理服务（AWS Secrets Manager、HashiCorp Vault）
- ✅ 配置管理系统

#### 2. 配置外部化
- ❌ 硬编码模型名称（如 `"gpt-4"`）
- ❌ 硬编码 URL、端口号
- ❌ 硬编码业务规则参数

**替代方案**：
- ✅ 统一的配置文件（YAML、JSON、TOML）
- ✅ 配置类或配置管理模块
- ✅ 支持多环境配置（开发/测试/生产）

### 适用场景
- 所有生产级项目
- 需要部署到多环境的应用
- 团队协作项目

### 实现建议
```
项目根目录/
├── .env.example          # 配置模板（可提交到 Git）
├── .env                  # 实际配置（加入 .gitignore）
├── config/
│   ├── development.yaml
│   ├── production.yaml
│   └── config_loader.py  # 配置加载逻辑
```

---

## 📝 代码质量标准

### 规则内容

#### 1. 日志规范
- ❌ **禁止**在生产代码中使用 `print()` 语句
- ✅ 使用标准日志库（Python: `logging`, JS: `winston/pino`, Java: `log4j`）
- ✅ 设置合理的日志级别（DEBUG/INFO/WARNING/ERROR）
- ✅ 包含上下文信息（时间戳、模块名、请求ID）

**示例**（Python）：
```python
# ❌ 不推荐
print(f"用户 {user_id} 登录成功")

# ✅ 推荐
logger.info(f"用户登录成功", extra={"user_id": user_id, "ip": request.ip})
```

#### 2. 文档字符串（Docstrings）
- ✅ 所有公共类、方法、函数必须有文档字符串
- ✅ 使用一致的风格（推荐：Google Style / NumPy Style）
- ✅ 包含参数说明、返回值、异常信息

**示例**（Google Style）：
```python
def calculate_discount(price: float, user_level: str) -> float:
    """计算用户折扣后的价格。

    Args:
        price: 原始价格（必须为正数）
        user_level: 用户等级 ('basic', 'premium', 'vip')

    Returns:
        折扣后的价格

    Raises:
        ValueError: 当价格为负数或用户等级无效时
    """
    pass
```

#### 3. 关注点分离
- ✅ **数据模型**与业务逻辑分离
- ✅ **配置**与代码分离
- ✅ **提示词/模板**与代码分离（AI 项目）
- ✅ 避免"上帝类"和过长函数（单一职责原则）

### 适用场景
- 所有专业开发项目
- 需要长期维护的代码库
- 团队协作场景

---

## 🔄 协作流程规范

### 规则内容

#### 1. 任务开始前：明确与澄清
- ✅ **复杂任务**：总结理解，列出关键假设，提出澄清问题
- ✅ **架构变更**：说明影响范围，征求确认
- ❌ 不要在不确定时猜测需求并直接实现

#### 2. 任务执行中：透明跟踪
- ✅ **多步骤任务**（≥3步）：创建 TODO 清单
- ✅ 实时更新进度
- ✅ 遇到阻碍时及时沟通

**TODO 清单示例**：
```markdown
## 任务：用户认证系统重构

- [x] 1. 设计新的认证流程
- [x] 2. 实现 JWT Token 生成
- [ ] 3. 添加刷新令牌机制
- [ ] 4. 编写单元测试
- [ ] 5. 更新 API 文档
```

#### 3. 问题解决：根因分析优先
- ✅ **先分析**：理解问题本质、定位根本原因
- ✅ **再建议**：基于分析提供解决方案
- ❌ 不要直接给出"快速修复"而不解释原因

#### 4. 里程碑提醒：版本控制
在以下时机提醒用户进行版本管理：
- ✅ 完成重要功能
- ✅ 架构变更
- ✅ 重大重构
- ✅ 发布前检查点

**提醒内容**：
- 更新版本号（遵循语义化版本）
- 提交变更（编写清晰的 commit message）
- 创建标签（用于发布版本）

### 适用场景
- 所有需要 AI 辅助的开发项目
- 特别适合复杂度高、协作紧密的场景

---

## 📚 文档维护原则

### 规则内容

#### 1. 文档与代码同步更新
- ✅ **架构变更** → 更新架构文档
- ✅ **API 变更** → 更新 API 文档
- ✅ **工作流变更** → 更新流程图/逻辑说明
- ✅ **配置变更** → 更新 README 和配置说明

#### 2. 核心文档建议
- `README.md`：项目概览、快速开始
- `CONTRIBUTING.md`：开发规范、贡献指南
- `ARCHITECTURE.md`：系统架构、设计决策
- `API.md` 或 Swagger/OpenAPI：接口文档
- `CHANGELOG.md`：版本历史

#### 3. 文档质量标准
- ✅ 使用清晰的标题层级
- ✅ 提供代码示例
- ✅ 包含图表（架构图、流程图）
- ✅ 保持简洁，避免冗余

### 适用场景
- 所有需要文档的项目（即几乎所有项目）
- 开源项目、团队项目尤其重要

---

## 🔧 项目特定部分（需定制）

以下内容需要根据项目调整，不属于通用规则：

### 1. 架构模式
- 三层架构、微服务、DDD、Clean Architecture 等
- 具体的目录结构和模块划分
- 基类/接口设计规范

**定制建议**：
```markdown
## 架构规范
- **控制器层** (`controllers/`): 处理 HTTP 请求
- **服务层** (`services/`): 业务逻辑
- **数据层** (`repositories/`): 数据访问
```

### 2. 技术栈规范
- 编程语言版本
- 框架选择（React/Vue, Django/Flask, Spring Boot 等）
- 依赖管理工具
- 测试框架

### 3. 文件路径约定
- 配置文件位置
- 日志文件位置
- 静态资源目录
- 测试文件目录

### 4. 验证工具
- Linter（ESLint, Pylint, Rubocop）
- 格式化工具（Prettier, Black, Rustfmt）
- 类型检查（TypeScript, mypy）
- 自定义验证脚本

---

## 📋 使用检查清单

将本指南应用到新项目时，请检查：

- [ ] 已定义沟通协议（设计优先于代码）
- [ ] 已建立配置管理系统（无硬编码敏感信息）
- [ ] 已配置日志系统（禁用 print 语句）
- [ ] 已定义文档字符串规范
- [ ] 已设置协作流程（TODO、版本控制提醒）
- [ ] 已创建核心文档结构
- [ ] 已根据项目特点定制架构规范
- [ ] 已配置代码质量工具（linter、formatter）

---

## 💡 实施建议

### 渐进式采用
1. **第一阶段**：采用沟通协议和配置管理（立即见效）
2. **第二阶段**：建立日志和文档规范（提升质量）
3. **第三阶段**：完善协作流程和工具链（长期收益）

### 团队推广
- 将本文档加入项目 `docs/` 目录
- 在团队会议上讨论并达成共识
- 在代码审查中强化规范执行
- 定期回顾和优化规则

### 持续改进
- 根据项目经验调整规则
- 收集团队反馈
- 关注行业最佳实践演进

---

## 📚 扩展阅读

- [Google Style Guides](https://google.github.io/styleguide/)
- [The Twelve-Factor App](https://12factor.net/)
- [Semantic Versioning](https://semver.org/)
- [Conventional Commits](https://www.conventionalcommits.org/)

---

**文档版本**: 1.0  
**最后更新**: 2026-02-07  
**适用范围**: 通用软件开发项目

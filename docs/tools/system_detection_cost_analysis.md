# 系统检测方案成本分析

## 方案对比

### 方案A：在Pass 2中集成系统检测

**优点**：
- 节省1次LLM调用
- 成本更低

**缺点**：
- ❌ Prompt污染风险，影响设定关联质量
- ❌ 违背Single Responsibility原则
- ❌ 输出解析复杂化
- ❌ 破坏已验证的NovelAnnotator稳定性

**单章成本**：
- LLM调用：2次
- Token消耗：~8K input + ~3K output
- 估算成本：$0.06 USD

---

### 方案B：独立Pass 3（推荐）⚡

**优点**：
- ✅ 任务分离，不污染原有prompt
- ✅ 保护NovelAnnotator稳定性
- ✅ 符合Single Responsibility原则
- ✅ Pass 3可选，灵活性高
- ✅ 系统检测prompt简洁，token消耗少

**缺点**：
- 多1次LLM调用
- 成本略增（但增幅很小）

**单章成本**：
- LLM调用：3次
- Pass 1: ~3K input + ~1K output
- Pass 2: ~5K input + ~2K output
- Pass 3: ~2K input + ~0.5K output ← 新增（轻量级）
- 总token消耗：~10K input + ~3.5K output
- 估算成本：$0.08 USD

**成本增加**：$0.02 USD/章（可接受）

---

## Pass 3 设计要点

### 为什么Pass 3成本低？

1. **输入简洁**
   - 只需要事件摘要 + A/C类段落内容
   - 不需要完整的Pass 1/Pass 2输出

2. **输出简单**
   - 只需要列出新发现的元素
   - 格式：`类别ID - 元素名称`

3. **推理简单**
   - 不需要复杂的时间线分析
   - 不需要设定关联判断
   - 只是模式匹配 + 归类

### Pass 3 Prompt示例

```yaml
system: |
  你是系统元素识别专家。根据已有的系统目录，识别本章中新出现的元素。

user_template: |
  【系统目录】（已识别的元素）
  {system_catalog_summary}
  
  【本章内容摘要】
  {chapter_events_summary}
  
  【C类段落】（系统交互场景）
  {c_class_paragraphs}
  
  任务：识别本章中新出现的、未在系统目录中的元素。
  
  输出格式：
  新元素1 → SC003（归类到：武器装备）
  新元素2 → SC002（归类到：生存资源）
  无新元素 → 输出"无"
```

---

## 100章成本估算

### 方案A（集成）
- 单章：$0.06
- 100章：$6.00

### 方案B（独立Pass 3）
- 单章：$0.08
- 100章：$8.00

**差异**：$2.00（100章）

**结论**：成本差异极小，但方案B的架构优势明显，**强烈推荐方案B**。

---

## 推荐决策

✅ **采用方案B：独立的Pass 3（NovelSystemDetector）**

理由：
1. 成本增加可控（$0.02/章）
2. 保护已验证工具的稳定性
3. 符合架构最佳实践
4. 可选性强，灵活度高

# NovelProcessingWorkflow 质量标准文档

## 评分体系

### 总体评分标准（百分制）

| 分数区间 | 等级 | 评价 | 使用建议 |
|---------|------|------|----------|
| 90-100 | A 优秀 | 几乎无错误 | 可直接使用 |
| 80-89 | B 良好 | 有轻微问题 | 建议修正后使用 |
| 70-79 | C 及格 | 有明显问题 | 必须修正后使用 |
| 60-69 | D 勉强 | 严重问题 | 需要重新处理 |
| <60 | F 不合格 | 不可用 | 必须重新处理 |

### 🚨 一票否决项（直接评为不合格）

以下任一项出现，直接评为F（<60分）：

1. **Step 4**: ABC分类误判 ≥3个/章
2. **Step 4**: 文本还原率 <95%
3. **Step 5**: 事件时间线出现逻辑混乱
4. **Step 6-7**: 系统追踪缺失核心元素（>30%）
5. **全流程**: 任一步骤崩溃导致数据丢失

---

## Step 4: 章节分段质量标准

### ABC分类准确性（50分）

#### 评分细则
- 抽检10章（或10%章节，取较大值）
- 每章人工验证5个段落（优先检查A类和边界段落）
- 误判计算：`误判率 = 误判段落数 / 检查段落总数`

| 误判率 | 得分 | 评级 |
|--------|------|------|
| 0% | 50 | 完美 |
| <5% | 45-49 | 优秀 |
| 5-10% | 40-44 | 良好 |
| 10-15% | 35-39 | 及格 |
| 15-20% | 30-34 | 勉强 |
| >20% | <30 | 不合格 |

#### 误判类型与严重度

| 误判类型 | 严重度 | 扣分 | 示例 |
|---------|--------|------|------|
| A类误判为B类 | 🔴 严重 | -10 | "回忆规则"误判为事件 |
| B类误判为A类 | 🟡 中等 | -5 | "获得装备"误判为设定 |
| C类误判为B类 | 🟡 中等 | -5 | "系统提示"误判为事件 |
| B类内部边界错误 | 🟢 轻微 | -2 | 事件拆分过细或过粗 |

#### ABC分布合理性验证

**不使用固定比例**，而是基于小说类型和位置：

```python
# 系统流小说（末哥超凡公路）
开篇章节(1-5章)：
  - A类：15-40%（世界观集中建立）
  - B类：50-75%
  - C类：5-15%（系统觉醒频繁）

中期章节(6-50章)：
  - A类：5-20%（偶尔补充设定）
  - B类：70-90%
  - C类：5-10%

后期章节(50+章)：
  - A类：0-10%（设定已建立完成）
  - B类：80-95%
  - C类：5-10%

# 日常流小说（天命桃花）
全书：
  - A类：0-10%（日常剧情少设定）
  - B类：85-95%
  - C类：0-5%（可能无系统）
```

**评分规则**：
- ABC分布符合类型：+5分
- ABC分布偏离类型但合理：0分
- ABC分布明显异常：-10分

### 分段粒度合理性（20分）

| 段落数/章 | 评价 | 得分 |
|----------|------|------|
| 8-15 | 理想 | 20 |
| 5-7 或 16-20 | 可接受 | 15 |
| 3-4 或 21-25 | 偏少/偏多 | 10 |
| <3 或 >25 | 异常 | 5 |

### 文本还原率（20分）

| 还原率 | 评价 | 得分 |
|--------|------|------|
| ≥99.5% | 优秀 | 20 |
| 99-99.4% | 良好 | 18 |
| 98-98.9% | 及格 | 15 |
| 95-97.9% | 勉强 | 10 |
| <95% | 不合格 | 0（一票否决） |

### 边界清晰度（10分）

人工抽检段落边界：
- 功能转换明显：10分
- 大部分转换清晰：7分
- 边界模糊但可接受：5分
- 边界混乱：0分

---

## Step 5: 章节标注质量标准

### 事件聚合准确性（40分）

#### 聚合粒度
- 单章事件数：3-10个（正常）
- 单章事件数：<3个 → 过度聚合（-10分）
- 单章事件数：>15个 → 拆分过细（-5分）

#### 聚合逻辑
抽检10章，每章验证3个事件：

| 聚合质量 | 评价 | 得分 |
|---------|------|------|
| 边界准确，粒度合理 | 优秀 | 40 |
| 1-2处轻微问题 | 良好 | 35 |
| 3-5处问题 | 及格 | 30 |
| >5处问题 | 不合格 | <30 |

### 时间线连贯性（30分）

| 检查项 | 满分 | 扣分规则 |
|--------|------|---------|
| 时间标注完整性 | 10 | 缺失1章-2分 |
| 时间顺序正确性 | 10 | 出现1次倒序-5分 |
| 时间跨度合理性 | 10 | 出现1次异常-3分 |

**一票否决**：时间线出现严重混乱（事件顺序完全错乱）

### 设定关联准确性（20分）

BF/BT/AF时机判断：
- 抽检30个设定
- 每个错误-2分

### 优先级分级合理性（10分）

| P0占比 | 评价 | 得分 |
|--------|------|------|
| 10-30% | 理想 | 10 |
| 5-10% 或 30-40% | 可接受 | 7 |
| <5% 或 >50% | 异常 | 3 |

---

## Step 6-7: 系统分析质量标准

### 系统类型识别（20分）

- 类型判断准确：20分
- 类型判断模糊但合理：15分
- 类型判断错误：0分

### 元素覆盖度（40分）

通过关键词搜索验证：
- 核心元素覆盖率：`覆盖数 / 应覆盖数`

| 覆盖率 | 得分 |
|--------|------|
| ≥95% | 40 |
| 90-94% | 35 |
| 80-89% | 30 |
| 70-79% | 20 |
| <70% | 0（一票否决） |

### 追踪准确性（30分）

抽检20个变化记录：
- 每个遗漏-3分
- 每个错误-2分

### 策略合理性（10分）

- 所有策略匹配元素特性：10分
- 1-2个策略不合理：7分
- >2个策略不合理：3分

---

## Step 8: 全流程质量验证

### 计算方法

```python
total_score = (
    step4_score * 0.35 +  # Step 4权重最高
    step5_score * 0.35 +  # Step 5权重最高
    step67_score * 0.20 + # 系统分析
    step123_score * 0.10  # 前置步骤
)
```

### 最终评级

| 总分 | 评级 | 建议 |
|------|------|------|
| ≥90 | A 优秀 | 可直接进入对齐工作流 |
| 80-89 | B 良好 | 修正已知问题后可用 |
| 70-79 | C 及格 | 必须修正关键问题 |
| 60-69 | D 勉强 | 建议重新处理 |
| <60 | F 不合格 | 必须重新处理 |

---

## 质量改进建议输出

### 建议分级

| 优先级 | 含义 | 响应时间 |
|--------|------|---------|
| P0 | 必须改进（影响后续流程） | 立即修正 |
| P1 | 建议改进（影响质量） | 批量修正 |
| P2 | 可选优化（锦上添花） | 可忽略 |

### 建议格式

```markdown
### 💡 改进建议

#### 优先级P0（必须改进）
1. **第23章ABC分类**
   - 问题：第3段"回忆车队规则"误判为B类
   - 影响：设定信息丢失，影响对齐分析
   - 修复方案：重新标记为A类
   - 预计影响：修正后评分提升5分

#### 优先级P1（建议改进）
1. **第34章事件聚合**
   - 问题：12个B段落聚合为2个事件，过度聚合
   - 影响：丢失情节转折点
   - 修复方案：拆分为4-5个事件
   - 预计影响：修正后评分提升3分
```

---

*最后更新: 2026-02-10*

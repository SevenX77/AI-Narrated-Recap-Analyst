# å¼€å‘è§„èŒƒä¸æ¶æ„æ–‡æ¡£ (Development Standards & Architecture)

## 0. æœ€é«˜ä¼˜å…ˆçº§ï¼šæ–‡æ¡£åŒæ­¥ (Documentation Sync - HIGHEST PRIORITY)

**ä»»ä½•ä»£ç å˜æ›´å¿…é¡»é¦–å…ˆä½“ç°åœ¨æ–‡æ¡£ä¸­ã€‚**

- **ä»£ç å³æ–‡æ¡£**: æ ¸å¿ƒé€»è¾‘å˜æ›´å¿…é¡»åŒæ­¥æ›´æ–° `docs/architecture/` ä¸‹çš„å¯¹åº”æ–‡æ¡£ã€‚
- **å¼ºåˆ¶æ£€æŸ¥**: è‡ªåŠ¨åŒ–è„šæœ¬ä¼šæ£€æŸ¥æ–‡æ¡£çš„æ›´æ–°æ—¶é—´ã€‚å¦‚æœä»£ç æ›´æ–°äº†ä½†æ–‡æ¡£æ²¡æ›´æ–°ï¼ŒCI/CD å°†ä¼šå¤±è´¥ã€‚
- **Docstrings**: æ‰€æœ‰ Public Class å’Œ Function å¿…é¡»åŒ…å« Google Style Docstringsã€‚
- **æ¶æ„å›¾**: å¤æ‚é€»è¾‘éœ€åœ¨æ–‡æ¡£ä¸­é€šè¿‡ Mermaid æˆ–æ–‡å­—æè¿°æ¸…æ¥šæ•°æ®æµå‘ã€‚

## 1. æ ¸å¿ƒåŸåˆ™ (Core Principles)

1.  **æ¨¡å—åŒ– (Modularity)**: 
    - ç³»ç»Ÿç”± **Tools (å·¥å…·)**, **Agents (æ™ºèƒ½ä½“)**, å’Œ **Workflows (å·¥ä½œæµ)** ç»„æˆã€‚
    - **Tools** å¿…é¡»æ˜¯æ— çŠ¶æ€ã€ç‹¬ç«‹çš„åŸå­æ“ä½œï¼ˆå¦‚ï¼šä¸‹è½½æ–‡ä»¶ã€åˆ‡å‰²æ–‡æœ¬ï¼‰ã€‚
    - **Agents** æ˜¯æœ‰çŠ¶æ€çš„ï¼Œè´Ÿè´£è°ƒç”¨ LLM è¿›è¡Œå†³ç­–æˆ–å¤„ç†ï¼Œå¹¶å¯ä»¥è°ƒç”¨ Toolsã€‚
    - **Workflows** æ˜¯ä¸šåŠ¡é€»è¾‘çš„ç¼–æ’è€…ï¼Œè´Ÿè´£ä¸²è” Agents å’Œ Toolsã€‚
    - ç¦æ­¢å¾ªç¯ä¾èµ–ã€‚

2.  **èŒè´£åˆ†ç¦» (Separation of Concerns)**:
    - **Analyst (åˆ†æå¸ˆ)**: å”¯ä¸€èŒè´£æ˜¯ **"ç†è§£" (Understanding)**ã€‚
        - è¾“å…¥: æ–‡æœ¬ (å°è¯´æˆ–è§£è¯´)ã€‚
        - è¾“å‡º: ç»“æ„åŒ–æ•°æ® (Events, Characters)ã€‚
        - **ç¦æ­¢**: Analyst ä¸åº”çŸ¥é“ "Script" æˆ– "Alignment" çš„å­˜åœ¨ã€‚
    - **Alignment (å¯¹é½å¼•æ“)**: å”¯ä¸€èŒè´£æ˜¯ **"æ˜ å°„" (Mapping)**ã€‚
        - è¾“å…¥: ä¸¤ç»„ç»“æ„åŒ–æ•°æ® (Novel Events, Script Events)ã€‚
        - è¾“å‡º: å®ƒä»¬ä¹‹é—´çš„å…³ç³» (Range/Mapping)ã€‚
        - **ç¦æ­¢**: Alignment ä¸åº”ç›´æ¥è¯»å–åŸå§‹å°è¯´æ–‡æœ¬è¿›è¡Œåˆ†æï¼Œåªå¤„ç†ç»“æ„åŒ–æ•°æ®ã€‚

## 2. ç›®å½•ç»“æ„ (Directory Structure)

```text
src/
â”œâ”€â”€ core/           # æ ¸å¿ƒæŠ½è±¡å±‚ (Base Classes, Interfaces, Config, Schemas)
â”œâ”€â”€ tools/          # ç‹¬ç«‹å·¥å…·åº“ (Stateless, Reusable)
â”œâ”€â”€ agents/         # æ™ºèƒ½ä½“å®ç° (Stateful, LLM-driven)
â”œâ”€â”€ workflows/      # ä¸šåŠ¡æµç¨‹ç¼–æ’ (Orchestration)
â”œâ”€â”€ modules/        # ä¸šåŠ¡é€»è¾‘æ¨¡å— (Alignment, etc.)
â”œâ”€â”€ utils/          # é€šç”¨è¾…åŠ©å‡½æ•° (Logging, Config)
â”œâ”€â”€ prompts/        # Prompt æ¨¡æ¿ (YAML/JSON)
â””â”€â”€ main.py         # å…¥å£æ–‡ä»¶
docs/
â”œâ”€â”€ architecture/   # æ¶æ„è®¾è®¡ä¸é€»è¾‘æ–‡æ¡£ (å¿…é¡»ä¸ä»£ç åŒæ­¥)
â”œâ”€â”€ maintenance/    # ç»´æŠ¤æ€§æ–‡æ¡£ (æ¸…ç†æŠ¥å‘Šã€å˜æ›´è®°å½•ã€è¿ç§»æ—¥å¿—)
â””â”€â”€ api/            # è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£ (å¯é€‰)
root/
â”œâ”€â”€ data/           # é¡¹ç›®æ•°æ®å­˜å‚¨ (Projects, Raw Data, Artifacts)
â”œâ”€â”€ output/         # ç³»ç»Ÿè¾“å‡º (Logs, Operation History)
â”œâ”€â”€ logs/           # è¿è¡Œæ—¥å¿— (Deprecated, moved to output/)
â””â”€â”€ scripts/        # è¿ç»´è„šæœ¬ (Validation, Migration)
```

### ğŸ“ æ–‡æ¡£ç®¡ç†è§„èŒƒ

**ä¿æŒæ ¹ç›®å½•ç®€æ´æ˜¯å¼ºåˆ¶è¦æ±‚ï¼**

| æ–‡æ¡£ç±»å‹ | å¿…é¡»æ”¾ç½®ä½ç½® | ç¤ºä¾‹ | è¯´æ˜ |
|---------|------------|------|------|
| æ ¸å¿ƒæ–‡æ¡£ | `docs/` æ ¹ç›®å½• | DEV_STANDARDS.md, PROJECT_STRUCTURE.md | æ°¸ä¹…æ€§ã€å…¨å±€æ€§çš„æ–‡æ¡£ |
| ç‰ˆæœ¬å˜æ›´ | `CHANGELOG.md`ï¼ˆæ ¹ç›®å½•ï¼‰ | - | ç‰ˆæœ¬å‘å¸ƒè®°å½•ï¼Œéµå¾ª Keep a Changelog è§„èŒƒ |
| æ¨¡å—æ–‡æ¡£ | `docs/{module}/` | docs/core/README.md | å„æ¨¡å—çš„æŠ€æœ¯å‚è€ƒæ–‡æ¡£ |
| å½’æ¡£æ–‡æ¡£ | `archive/docs/` | archive/docs/v2_architecture/ | æ—§ç‰ˆæœ¬æ–‡æ¡£å½’æ¡£ |

**âŒ ä¸¥æ ¼ç¦æ­¢**ï¼š
- âŒ åœ¨æ ¹ç›®å½•åˆ›å»ºè¿‡ç¨‹æ€§/æ€»ç»“æ€§æ–‡æ¡£ï¼ˆå¦‚ PROJECT_RESET_SUMMARY.md, MIGRATION_SUMMARY.mdï¼‰
- âŒ åœ¨æ ¹ç›®å½•åˆ›å»ºä»»ä½•é™¤ CHANGELOG.md å¤–çš„ `.md` æˆ– `.txt` æ–‡æ¡£
- âŒ åœ¨ `docs/` åˆ›å»º"ä½¿ç”¨æ•™ç¨‹"ç±»æ–‡æ¡£
- âŒ åœ¨æ ¹ç›®å½•åˆ›å»ºä¸´æ—¶æµ‹è¯•æ–‡ä»¶

### ğŸ“ æ–‡æ¡£å†…å®¹è§„èŒƒ

**æ–‡æ¡£ç›®çš„**: æ–‡æ¡£æ˜¯ä»£ç çš„æŠ€æœ¯å‚è€ƒï¼Œä¸æ˜¯ä½¿ç”¨æ•™ç¨‹ã€‚

**å¿…é¡»åŒ…å«**ï¼š
1. **æ¥å£å®šä¹‰**: è¾“å…¥è¾“å‡ºå‚æ•°ã€ç±»å‹ã€æ ¼å¼
2. **å®ç°é€»è¾‘**: æ ¸å¿ƒç®—æ³•ã€å¤„ç†æµç¨‹ã€è®¾è®¡æ€è·¯
3. **ä¾èµ–å…³ç³»**: è°ƒç”¨äº†å“ªäº›å·¥å…·/æ¨¡å—/Agent
4. **æ•°æ®æ¨¡å‹**: ä½¿ç”¨çš„Schemaå®šä¹‰

**ç¦æ­¢åŒ…å«**ï¼š
- âŒ "å¦‚ä½•ä½¿ç”¨"æ•™ç¨‹å¼å†…å®¹
- âŒ "è¿è¡Œæ­¥éª¤"æ“ä½œæŒ‡å—
- âŒ è¿‡ç¨‹æ€§è®°å½•ï¼ˆ"æˆ‘åšäº†ä»€ä¹ˆ"ï¼‰
- âŒ æ€»ç»“æ€§æŠ¥å‘Š

**æ–‡æ¡£ç¤ºä¾‹ç»“æ„**ï¼š
```markdown
# ToolName

## èŒè´£ (Responsibility)
ç®€è¿°è¯¥å·¥å…·çš„å•ä¸€èŒè´£

## æ¥å£ (Interface)
### è¾“å…¥ (Input)
- å‚æ•°1: ç±»å‹, è¯´æ˜
- å‚æ•°2: ç±»å‹, è¯´æ˜

### è¾“å‡º (Output)
è¿”å›å€¼ç±»å‹å’Œç»“æ„è¯´æ˜

## å®ç°é€»è¾‘ (Implementation Logic)
1. æ­¥éª¤1: åšä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆ
2. æ­¥éª¤2: è°ƒç”¨å“ªä¸ªå·¥å…·/å‡½æ•°
3. æ­¥éª¤3: å¦‚ä½•å¤„ç†ç»“æœ

## ä¾èµ– (Dependencies)
- Schema: ä½¿ç”¨çš„æ•°æ®æ¨¡å‹
- Tools: ä¾èµ–çš„å…¶ä»–å·¥å…·
- Config: éœ€è¦çš„é…ç½®é¡¹

## ç¤ºä¾‹ä»£ç  (Code Example)
```python
# ä»…å±•ç¤ºæ¥å£è°ƒç”¨ï¼Œä¸æ˜¯å®Œæ•´ä½¿ç”¨æµç¨‹
tool = ToolName(config)
result = tool.execute(input_data)
```
```

### ğŸ“‹ CHANGELOG ç®¡ç†è§„èŒƒ

**æ ¼å¼**: éµå¾ª [Keep a Changelog](https://keepachangelog.com/) è§„èŒƒ

**ä½•æ—¶æ›´æ–°**:
- âœ… å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼ˆå¿…é¡»ï¼‰
- âœ… æ–°å¢é‡è¦åŠŸèƒ½ï¼ˆAddedï¼‰
- âœ… ä¿®æ”¹ç ´åæ€§æ¥å£ï¼ˆChangedï¼‰
- âœ… åºŸå¼ƒåŠŸèƒ½ï¼ˆDeprecatedï¼‰
- âœ… ç§»é™¤åŠŸèƒ½ï¼ˆRemovedï¼‰
- âœ… ä¿®å¤Bugï¼ˆFixedï¼‰

**ç‰ˆæœ¬å·è§„åˆ™**: éµå¾ª [Semantic Versioning](https://semver.org/)
- ä¸»ç‰ˆæœ¬å·: ä¸å…¼å®¹çš„ API ä¿®æ”¹
- æ¬¡ç‰ˆæœ¬å·: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢
- ä¿®è®¢å·: å‘ä¸‹å…¼å®¹çš„Bugä¿®å¤

**ä¸åº”è®°å½•**:
- âŒ æ¯æ¬¡ä»£ç æäº¤
- âŒ å†…éƒ¨é‡æ„ï¼ˆé™¤éå½±å“APIï¼‰
- âŒ æ–‡æ¡£æ›´æ–°ï¼ˆé™¤éæ˜¯é‡å¤§æ–‡æ¡£ç»“æ„å˜æ›´ï¼‰
- âŒ é…ç½®è°ƒæ•´

## 3. æ¨¡å—å®šä¹‰è§„èŒƒ (Module Specifications)

### 3.1 Tools (å·¥å…·)
- ç»§æ‰¿è‡ª `src.core.interfaces.BaseTool`ã€‚
- å¿…é¡»å®ç° `execute` æ–¹æ³•ã€‚
- è¾“å…¥è¾“å‡ºå¿…é¡»å¼ºç±»å‹ (Type Hinting)ã€‚
- **ç¦æ­¢** åœ¨ Tool å†…éƒ¨ç›´æ¥è°ƒç”¨ Agentã€‚

**ç°æœ‰å·¥å…·**:
- `NovelImporter`: å°è¯´å¯¼å…¥ä¸è§„èŒƒåŒ–ï¼ˆç¼–ç æ£€æµ‹ã€æ ¼å¼æ¸…ç†ï¼‰
- `NovelMetadataExtractor`: å…ƒæ•°æ®æå–ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€æ ‡ç­¾ã€ç®€ä»‹ï¼‰**[æ”¯æŒåŒLLM]** é»˜è®¤ DeepSeek
- `NovelChapterDetector`: ç« èŠ‚è¾¹ç•Œæ£€æµ‹ä¸ä¿¡æ¯æå–
- `NovelSegmenter`: å°è¯´å™äº‹åŠŸèƒ½åˆ†æ®µåˆ†æï¼ˆçº¯LLMé©±åŠ¨ï¼‰**[æ”¯æŒåŒLLM]** é»˜è®¤ Claude â­ **æ¨èä½¿ç”¨**
- *(å½’æ¡£)* `NovelChapterProcessor`: å°è¯´ç« èŠ‚æ‹†åˆ†ä¸ç®€ä»‹æå–
- *(å½’æ¡£)* `IntroductionValidator`: ç®€ä»‹è´¨é‡éªŒè¯
- *(å½’æ¡£)* `SrtScriptProcessor`: SRTå­—å¹•å¤„ç†ï¼ˆæ”¯æŒæœ‰/æ— å°è¯´å‚è€ƒä¸¤ç§æ¨¡å¼ï¼‰
- *(å½’æ¡£)* `NovelChapterAnalyzer`: å°è¯´ç« èŠ‚åŠŸèƒ½æ®µåˆ†æï¼ˆåŠŸèƒ½æ®µçº§åˆ«ï¼‰
- *(å½’æ¡£)* `NovelSegmentationAnalyzer`: å°è¯´åˆ†æ®µæ·±åº¦åˆ†æï¼ˆè‡ªç„¶æ®µçº§åˆ«ï¼‰
- *(å½’æ¡£)* `ScriptSegmentAligner`: Script-Novelç²¾ç¡®å¯¹é½ä¸æ”¹ç¼–åˆ†æ
- *(å½’æ¡£)* `KeyInfoExtractor`: å…³é”®ä¿¡æ¯æå–ä¸æ±‡æ€»
- ~~`NovelSegmentationTool`~~: å·²åºŸå¼ƒï¼ˆè§„åˆ™åˆ†æ®µï¼Œè´¨é‡ä¸è¾¾æ ‡ï¼‰â†’ å½’æ¡£åˆ° `archive/v2_deprecated/`

### 3.2 Agents (æ™ºèƒ½ä½“)
- ç»§æ‰¿è‡ª `src.core.interfaces.BaseAgent`ã€‚
- æ‹¥æœ‰ `context` (ä¸Šä¸‹æ–‡)ã€‚
- é€šè¿‡ `process` æ–¹æ³•å¤„ç†ä»»åŠ¡ã€‚

### 3.3 Workflows (å·¥ä½œæµ)
- ç»§æ‰¿è‡ª `src.core.interfaces.BaseWorkflow`ã€‚
- å®šä¹‰æ˜ç¡®çš„ `steps` (æ­¥éª¤)ã€‚
- è´Ÿè´£é”™è¯¯å¤„ç†å’Œå…¨å±€çŠ¶æ€ç®¡ç†ã€‚

### 3.4 Modules (ä¸šåŠ¡æ¨¡å—)
- å­˜æ”¾äº `src/modules/`ã€‚
- è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘æˆ–ç®—æ³•å®ç°ï¼ˆå¦‚ Alignment, Ingestionï¼‰ã€‚
- å¯ä»¥åŒ…å«å¤æ‚çš„é€»è¾‘ï¼Œä½†ä¸åº”åƒ Agent é‚£æ ·å…·æœ‰è‡ªä¸»å†³ç­–æ€§ã€‚
- åº”å°½é‡ä¿æŒæ— çŠ¶æ€æˆ–ä»…ä¾èµ–è¾“å…¥æ•°æ®ã€‚
- å¿…é¡»å®šä¹‰æ¸…æ™°çš„è¾“å…¥è¾“å‡º Schemaã€‚

### 3.5 Core (æ ¸å¿ƒå±‚)
- å­˜æ”¾äº `src/core/`ã€‚
- ä»…åŒ…å«ï¼š
    - **Interfaces**: æŠ½è±¡åŸºç±» (Base Classes)ã€‚
    - **Config**: é…ç½®å®šä¹‰ä¸åŠ è½½ã€‚
    - **Schemas**: Pydantic æ•°æ®æ¨¡å‹ã€‚
    - **Managers**: èµ„æºç®¡ç†å™¨ï¼ˆå¦‚ LLMClientManager, ArtifactManagerï¼‰ã€‚
- **ç¦æ­¢** åŒ…å«å…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°ã€‚

**æ ¸å¿ƒç®¡ç†å™¨**:
- `LLMClientManager`: LLM å®¢æˆ·ç«¯ç»Ÿä¸€ç®¡ç†
    - æ”¯æŒå¤š Providerï¼ˆClaudeã€DeepSeekï¼‰
    - å•ä¾‹æ¨¡å¼ç®¡ç†å®¢æˆ·ç«¯å®ä¾‹
    - è‡ªåŠ¨è®°å½•ä½¿ç”¨ç»Ÿè®¡ï¼ˆToken æ¶ˆè€—ã€è°ƒç”¨æ¬¡æ•°ï¼‰
    - ä½ç½®ï¼š`src/core/llm_client_manager.py`
    - æ–‡æ¡£ï¼š`docs/core/DUAL_LLM_SETUP.md`
- `ArtifactManager`: å·¥ä»¶ç‰ˆæœ¬ç®¡ç†ï¼ˆå·²æœ‰ï¼‰
- `ProjectManager`: é¡¹ç›®æ•°æ®ç®¡ç†ï¼ˆå·²æœ‰ï¼‰

### 3.6 Utils (å·¥å…·åº“)
- å­˜æ”¾äº `src/utils/`ã€‚
- å¿…é¡»æ˜¯çº¯å‡½æ•° (Pure Functions) æˆ–é€šç”¨ Helper ç±»ã€‚
- **ç¦æ­¢** åŒ…å«ä¸šåŠ¡çŠ¶æ€æˆ–ç‰¹å®šä¸šåŠ¡é€»è¾‘ã€‚
- **ç¦æ­¢** å¾ªç¯ä¾èµ– Core æˆ– Modulesã€‚

## 4. å·¥ä½œæµä¸é€»è¾‘åŒæ­¥ (Workflow & Logic Sync)

ä»»ä½•æ—¶å€™ä¿®æ”¹ `src/workflows` æˆ–æ ¸å¿ƒç®—æ³•æ—¶ï¼Œå¿…é¡»åŒæ­¥æ›´æ–° `docs/architecture/logic_flows.md`ã€‚

## 5. é…ç½®ä¸å¯†é’¥ç®¡ç† (Configuration & Secrets)

- **å•ä¸€æ•°æ®æº**: æ‰€æœ‰é…ç½®ï¼ˆAPI Keys, Model Names, Pathsï¼‰å¿…é¡»é€šè¿‡ `src/core/config.py` ç»Ÿä¸€ç®¡ç†ï¼Œç¦æ­¢åœ¨ä¸šåŠ¡ä»£ç ä¸­ç¡¬ç¼–ç é»˜è®¤å€¼ã€‚
- **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯å¿…é¡»é€šè¿‡ `.env` æ–‡ä»¶åŠ è½½ï¼Œä½¿ç”¨ `pydantic-settings` æˆ– `os.environ` è¯»å–ã€‚
- **ç¦æ­¢æäº¤**: `.env` æ–‡ä»¶å¿…é¡»åŒ…å«åœ¨ `.gitignore` ä¸­ã€‚

### 5.1 LLM Provider é…ç½®

é¡¹ç›®æ”¯æŒå¤šä¸ª LLM Provider åŒæ—¶ä½¿ç”¨ï¼Œé€šè¿‡ `LLMClientManager` ç»Ÿä¸€ç®¡ç†ã€‚

**ç¯å¢ƒå˜é‡é…ç½®**ï¼š
```bash
# Claude é…ç½®
CLAUDE_API_KEY=sk-xxx
CLAUDE_BASE_URL=https://api.anthropic.com
CLAUDE_MODEL_NAME=claude-sonnet-4-5-20250929

# DeepSeek é…ç½®
DEEPSEEK_API_KEY=sk-xxx
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_MODEL_NAME=deepseek-chat
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```python
from src.core.llm_client_manager import get_llm_client, get_model_name

# åœ¨å·¥å…·åˆå§‹åŒ–æ—¶æŒ‡å®š Provider
client = get_llm_client("claude")  # æˆ– "deepseek"
model = get_model_name("claude")
```

**åŠŸèƒ½åˆ†å·¥ç­–ç•¥**ï¼š
- **ç®€å•ä»»åŠ¡**ï¼ˆå…ƒæ•°æ®æå–ã€æ ¼å¼å¤„ç†ï¼‰â†’ DeepSeekï¼ˆé€Ÿåº¦å¿«ã€æˆæœ¬ä½ï¼‰
- **å¤æ‚ä»»åŠ¡**ï¼ˆå°è¯´åˆ†æ®µã€æ”¹ç¼–åˆ†æï¼‰â†’ Claudeï¼ˆè´¨é‡é«˜ã€ç†è§£å¼ºï¼‰
- **æ¨ç†ä»»åŠ¡**ï¼ˆè§„åˆ™æå–ã€é€»è¾‘åˆ†æï¼‰â†’ DeepSeek R1ï¼ˆä¸“ç”¨æ¨ç†æ¨¡å‹ï¼‰

è¯¦ç»†é…ç½®ï¼šå‚è§ `docs/core/DUAL_LLM_SETUP.md`

## 6. Prompt å·¥ç¨‹è§„èŒƒ (Prompt Engineering)

- **Prompt åˆ†ç¦»**: ç¦æ­¢å°†é•¿ Prompt å­—ç¬¦ä¸²ç¡¬ç¼–ç åœ¨ Python å‡½æ•°å†…éƒ¨ã€‚
- **å­˜å‚¨ä½ç½®**: å°† Prompt æå–åˆ° `src/prompts/` ç›®å½•ä¸‹çš„ YAML/JSON æ–‡ä»¶ä¸­ã€‚
- **ç‰ˆæœ¬æ§åˆ¶**: Prompt çš„å˜æ›´åº”è§†ä¸ºä»£ç å˜æ›´ï¼Œéœ€è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚

**ç°æœ‰Prompté…ç½®**:
- `introduction_extraction.yaml`: å°è¯´ç®€ä»‹æ™ºèƒ½è¿‡æ»¤
- `srt_script_processing_with_novel.yaml`: SRTå¤„ç†ï¼ˆæœ‰å°è¯´å‚è€ƒï¼‰
- `srt_script_processing_without_novel.yaml`: SRTå¤„ç†ï¼ˆæ— å°è¯´å‚è€ƒï¼Œæ™ºèƒ½å®ä½“è¯†åˆ«ï¼‰
- `layered_extraction.yaml`: åˆ†å±‚å¯¹é½çš„æƒ…èŠ‚èŠ‚ç‚¹æå–
- `novel_chapter_functional_analysis.yaml`: å°è¯´ç« èŠ‚åŠŸèƒ½æ®µåˆ†æï¼ˆå™äº‹åŠŸèƒ½çº§åˆ«ï¼‰â­ **æ¨èä½¿ç”¨**
- `novel_segmentation_analysis.yaml`: å°è¯´åˆ†æ®µæ·±åº¦åˆ†æï¼ˆè‡ªç„¶æ®µçº§åˆ«ï¼‰
- `script_alignment_analysis.yaml`: Script-Novelå¯¹é½ä¸æ”¹ç¼–åˆ†æ
- å…¶ä»–åˆ†æå’Œå¯¹é½ç›¸å…³prompts...

## 7. é”™è¯¯å¤„ç†ä¸æ—¥å¿— (Error Handling & Logging)

- **ç¦æ­¢ Print**: ç”Ÿäº§ç¯å¢ƒä»£ç ç¦æ­¢ä½¿ç”¨ `print()`ï¼Œå¿…é¡»ä½¿ç”¨ `logging` æ¨¡å—ã€‚
- **ç»“æ„åŒ–æ—¥å¿—**: æ—¥å¿—åº”åŒ…å« `timestamp`, `module`, `level`, `message`ã€‚
- **æ“ä½œæ—¥å¿— (Operation Log)**:
    - å…³é”®çš„æ–‡ä»¶ç”Ÿæˆæ“ä½œå¿…é¡»è®°å½•åˆ° `output/operation_history.jsonl`ã€‚
    - æ ¼å¼: `[Time] [ProjectID] [Action] -> [Output File]`ã€‚
- **é‡è¯•æœºåˆ¶**: å¯¹äº LLM è°ƒç”¨å’Œç½‘ç»œè¯·æ±‚ï¼Œå¿…é¡»å®ç°æŒ‡æ•°é€€é¿ (Exponential Backoff) çš„é‡è¯•æœºåˆ¶ã€‚

## 8. æ•°æ®å¥‘çº¦ (Data Contracts)

- **Schema å®šä¹‰**: æ¨¡å—é—´ä¼ é€’çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ `SceneAnalysis`, `NarrativeEvent`ï¼‰åº”å®šä¹‰ä¸º Pydantic Modelsã€‚
- **ç»Ÿä¸€ä½ç½®**: ç»Ÿä¸€æ”¾ç½®åœ¨ `src/core/schemas.py` ä¸­ï¼Œç¦æ­¢æ•£è½åœ¨å„ä¸ª Agent æ–‡ä»¶é‡Œã€‚

---
*Last Updated: 2026-02-03*

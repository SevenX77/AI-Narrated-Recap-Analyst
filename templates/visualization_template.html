<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovelProcessing 结果可视化</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #f5f5f7;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            background: #f8f8f8;
            border-bottom: 2px solid #e0e0e0;
            padding: 0 30px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        .chapter-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .chapter-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .chapter-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .stat-badge.a-class {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .stat-badge.b-class {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .stat-badge.c-class {
            background: #fce4ec;
            color: #c2185b;
        }
        
        .paragraph {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #ddd;
        }
        
        .paragraph.type-a {
            border-left-color: #1976d2;
            background: #f8fbff;
        }
        
        .paragraph.type-b {
            border-left-color: #f57c00;
            background: #fffbf5;
        }
        
        .paragraph.type-c {
            border-left-color: #c2185b;
            background: #fffafc;
        }
        
        .paragraph-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .paragraph-index {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        
        .paragraph-type {
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .paragraph-type.type-a {
            background: #1976d2;
            color: white;
        }
        
        .paragraph-type.type-b {
            background: #f57c00;
            color: white;
        }
        
        .paragraph-type.type-c {
            background: #c2185b;
            color: white;
        }
        
        .paragraph-content {
            line-height: 1.8;
            color: #333;
            font-size: 14px;
        }
        
        .json-viewer {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .event-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .event-summary {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .event-detail {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .system-element {
            background: #f5f5f5;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .system-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .system-desc {
            font-size: 13px;
            color: #666;
        }
        
        .tag {
            display: inline-block;
            padding: 4px 10px;
            background: #e0e0e0;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="title">NovelProcessing 结果可视化</h1>
            <p id="subtitle">项目：<span id="project-name"></span> | 生成时间：<span id="created-at"></span></p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('segmentation')">分段结果</button>
            <button class="tab" onclick="switchTab('annotation')">标注结果</button>
            <button class="tab" onclick="switchTab('system')">系统分析</button>
            <button class="tab" onclick="switchTab('raw')">原始JSON</button>
        </div>
        
        <div class="content">
            <!-- 分段结果 -->
            <div id="segmentation-tab" class="tab-pane active">
                <div id="segmentation-content"></div>
            </div>
            
            <!-- 标注结果 -->
            <div id="annotation-tab" class="tab-pane">
                <div id="annotation-content"></div>
            </div>
            
            <!-- 系统分析 -->
            <div id="system-tab" class="tab-pane">
                <div id="system-content"></div>
            </div>
            
            <!-- 原始JSON -->
            <div id="raw-tab" class="tab-pane">
                <pre class="json-viewer" id="raw-json"></pre>
            </div>
        </div>
    </div>
    
    <script>
        let data = {DATA_PLACEHOLDER};
        
        function switchTab(tabName) {
            // 更新tab样式
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // 切换内容
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        function renderSegmentation() {
            const container = document.getElementById('segmentation-content');
            if (!data.chapters) return;
            
            let html = '';
            for (const [chapterNum, result] of Object.entries(data.chapters)) {
                const paragraphs = result.paragraphs || [];
                const aCount = paragraphs.filter(p => p.type === 'A').length;
                const bCount = paragraphs.filter(p => p.type === 'B').length;
                const cCount = paragraphs.filter(p => p.type === 'C').length;
                
                html += `
                    <div class="chapter-card">
                        <div class="chapter-header">
                            <div class="chapter-title">第${chapterNum}章</div>
                            <div class="chapter-stats">
                                <span class="stat-badge a-class">A类: ${aCount}</span>
                                <span class="stat-badge b-class">B类: ${bCount}</span>
                                <span class="stat-badge c-class">C类: ${cCount}</span>
                            </div>
                        </div>
                `;
                
                paragraphs.forEach(para => {
                    const typeLabel = {
                        'A': 'A类-设定',
                        'B': 'B类-事件',
                        'C': 'C类-系统'
                    }[para.type] || para.type;
                    
                    html += `
                        <div class="paragraph type-${para.type.toLowerCase()}">
                            <div class="paragraph-header">
                                <span class="paragraph-index">段落 ${para.index}</span>
                                <span class="paragraph-type type-${para.type.toLowerCase()}">${typeLabel}</span>
                            </div>
                            <div class="paragraph-content">${para.content}</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }
        
        function renderAnnotation() {
            const container = document.getElementById('annotation-content');
            if (!data.annotations) {
                container.innerHTML = '<p style="color: #666;">暂无标注数据</p>';
                return;
            }
            
            let html = '';
            for (const [chapterNum, annotation] of Object.entries(data.annotations)) {
                html += `
                    <div class="chapter-card">
                        <div class="chapter-title">第${chapterNum}章 - 事件标注</div>
                `;
                
                if (annotation.events) {
                    annotation.events.forEach((event, idx) => {
                        html += `
                            <div class="event-card">
                                <div class="event-summary">${idx + 1}. ${event.summary || '事件'}</div>
                                <div class="event-detail">段落范围: ${event.paragraph_range?.join(', ') || 'N/A'}</div>
                                <div class="event-detail">优先级: ${event.priority || 'N/A'}</div>
                            </div>
                        `;
                    });
                }
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }
        
        function renderSystem() {
            const container = document.getElementById('system-content');
            if (!data.system_catalog) {
                container.innerHTML = '<p style="color: #666;">暂无系统分析数据</p>';
                return;
            }
            
            let html = '<h2>系统元素</h2>';
            
            const catalog = data.system_catalog;
            if (catalog.elements) {
                catalog.elements.forEach(elem => {
                    html += `
                        <div class="system-element">
                            <div class="system-name">${elem.name || '未命名元素'}</div>
                            <div class="system-desc">${elem.description || ''}</div>
                            <div>${elem.category ? `<span class="tag">${elem.category}</span>` : ''}</div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }
        
        function renderRawJSON() {
            document.getElementById('raw-json').textContent = JSON.stringify(data, null, 2);
        }
        
        // 初始化
        document.getElementById('project-name').textContent = data.project_name || 'Unknown';
        document.getElementById('created-at').textContent = data.created_at ? new Date(data.created_at).toLocaleString('zh-CN') : 'N/A';
        
        renderSegmentation();
        renderAnnotation();
        renderSystem();
        renderRawJSON();
    </script>
</body>
</html>
